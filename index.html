<div class="container mx-auto">

    <header class="text-center mb-8">

        <h1 class="text-3xl font-extrabold text-blue-800">ACAMS Study Buddy üéì</h1>

        <p class="text-gray-600">Seu Tutor Amig√°vel e Especializado em Preven√ß√£o √† Lavagem de Dinheiro (PLD/AML).</p>

    </header>



    <input type="hidden" id="apiKey" value=AIzaSyDeuI8un1P92k8C5czNvuclqiEDoIgt308>

    

    <div id="apiKeyAlert" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert" style="display: none;">

        <strong class="font-bold">Aten√ß√£o!</strong> 

        <span class="block sm:inline">Por favor, insira sua Gemini API Key no c√≥digo-fonte (linha 30) para que a aplica√ß√£o funcione.</span>

    </div>



    <div class="bg-white shadow-xl rounded-lg p-6 mb-8 border border-blue-200">

        <h2 class="text-2xl font-bold mb-4 text-blue-700 border-b pb-2">1. Anota√ß√µes & Resumo Contextual</h2>

        

        <textarea id="notesInput" class="w-full h-40 p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mb-4 text-sm" placeholder="Cole seus rascunhos, anota√ß√µes de aula ou textos de estudo aqui. A IA usar√° este texto como contexto!"></textarea>

        

        <button id="summarizeBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-300 disabled:opacity-50">

            Gerar Resumo e Salvar Anota√ß√£o üìù

        </button>



        <div id="summaryOutput" class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 text-gray-800 hidden">

            <h3 id="outputSummaryTitle" class="font-semibold text-lg mb-2 text-green-700"></h3>

            </div>

    </div>



    <div class="bg-white shadow-xl rounded-lg p-6 mb-8 border border-blue-200">

        <h2 class="text-2xl font-bold mb-4 text-blue-700 border-b pb-2">2. Tradutor PLD/AML & Exemplos</h2>

        

        <div class="flex space-x-2 mb-4">

            <input type="text" id="translationInput" class="flex-grow p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm" placeholder="Digite a palavra ou termo em Ingl√™s (ex: 'due diligence')">

            <button id="translateBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition duration-300">

                Traduzir e Contextualizar

            </button>

        </div>



        <div id="translationOutput" class="mt-4 hidden">

            <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">

                <p class="text-xl font-bold mb-1 text-blue-800"><span id="outputWordEN"></span>: <span id="outputTranslationPT" class="text-yellow-700"></span></p>

                <p class="text-gray-700 mb-3"><span class="font-semibold">Defini√ß√£o PLD:</span> <span id="outputDefinitionPT"></span></p>

                

                <h4 class="font-semibold mt-2 text-blue-600">3 Frases de Exemplo (Contexto ACAMS):</h4>

                <ul id="examplesList" class="list-disc pl-5 mt-2 space-y-3 text-sm">

                    </ul>

            </div>

        </div>

    </div>

    

    <div class="bg-white shadow-xl rounded-lg p-6 mb-8 border border-blue-200">

        <h2 class="text-2xl font-bold mb-4 text-blue-700 border-b pb-2">3. Gerador de Quiz (M√∫ltipla Escolha)</h2>

        

        <p class="text-gray-600 mb-4">Gere perguntas de exame baseadas no texto que voc√™ colou na se√ß√£o "Anota√ß√µes" acima.</p>



        <button id="quizBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded transition duration-300 disabled:opacity-50">

            Gerar Quiz de 5 Perguntas

        </button>

        

        <div id="quizOutput" class="mt-6 hidden">

            <h3 class="font-semibold text-lg mb-4 text-purple-700">Seu Simulado PLD/AML:</h3>

            <div id="quizQuestions" class="space-y-6">

                </div>

        </div>

    </div>

    

    <div class="bg-white shadow-xl rounded-lg p-6 mb-8 border border-blue-200">

        <h2 class="text-2xl font-bold mb-4 text-blue-700 border-b pb-2">4. Hist√≥rico de Revis√µes Salvas (Local)</h2>

        

        <div id="historyList" class="space-y-3">

            <p id="noHistory" class="text-gray-500 italic">Nenhuma anota√ß√£o salva ainda. Gere um resumo para come√ßar!</p>

            </div>

    </div>



    <p id="loadingIndicator" class="text-center text-blue-500 font-semibold mt-8 hidden">

        Processando... o Tutor Amig√°vel est√° pensando no seu conte√∫do.

    </p>



</div>



<script>
        // === CONFIGURA√á√ÉO E VARI√ÅVEIS ===
        const HISTORY_KEY = 'acams_study_history';
        // üö® CHAVE API (Mantenha sua chave real inserida aqui, DENTRO das aspas) üö®
        const API_KEY = "AIzaSyDeuI8un1P92k8C5czNvuclqiEDoIgt308"; 
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + API_KEY;
        
        // Elementos da UI (mantidos os mesmos)
        const notesInput = document.getElementById('notesInput');
        const summarizeBtn = document.getElementById('summarizeBtn');
        const quizBtn = document.getElementById('quizBtn');
        const translateBtn = document.getElementById('translateBtn');
        const translationInput = document.getElementById('translationInput');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const historyList = document.getElementById('historyList');

        // Estado inicial dos bot√µes
        const checkButtonsStatus = () => {
            const hasNotes = notesInput.value.trim().length > 10; 
            summarizeBtn.disabled = !hasNotes;
            quizBtn.disabled = !hasNotes;
            translateBtn.disabled = translationInput.value.trim().length === 0;
        };

        notesInput.addEventListener('input', checkButtonsStatus);
        translationInput.addEventListener('input', checkButtonsStatus);
        checkButtonsStatus();

        // Alerta de API Key (mantido na tela)
        if (API_KEY === 'SEU_GEMINI_API_KEY_AQUI' || !API_KEY) {
            document.getElementById('apiKeyAlert').style.display = 'block';
        }

        // === FUN√á√ïES DE HIST√ìRICO (LOCAL STORAGE) ===
        const loadHistory = () => {
            try {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
                return history.sort((a, b) => new Date(b.date) - new Date(a.date));
            } catch (e) {
                console.error("Erro ao carregar hist√≥rico local:", e);
                return [];
            }
        };

        const saveNoteToHistory = (theme, originalText, aiSummary) => {
            const history = loadHistory();
            const newNote = {
                id: Date.now(),
                date: new Date().toLocaleString('pt-BR'),
                theme: theme,
                original_notes: originalText,
                ai_summary: aiSummary
            };
            history.unshift(newNote);
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            renderHistory();
            alert(`Anota√ß√£o "${theme}" salva com sucesso no hist√≥rico local!`);
        };

        const renderHistory = () => {
            const history = loadHistory();
            historyList.innerHTML = '';
            
            if (history.length === 0) {
                historyList.innerHTML = '<p id="noHistory" class="text-gray-500 italic">Nenhuma anota√ß√£o salva ainda. Gere um resumo para come√ßar!</p>';
                return;
            }

            history.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'bg-white border border-gray-300 rounded-lg p-3 shadow-sm flex justify-between items-center';
                
                const info = document.createElement('div');
                info.innerHTML = `
                    <p class="font-bold text-gray-800">${item.theme}</p>
                    <p class="text-xs text-gray-500">Salvo em: ${item.date}</p>
                `;
                itemDiv.appendChild(info);

                const actionBtn = document.createElement('button');
                actionBtn.className = 'bg-blue-100 text-blue-700 hover:bg-blue-200 font-semibold py-1 px-3 rounded text-sm transition duration-300';
                actionBtn.textContent = 'Carregar para Revis√£o üîÑ';
                
                actionBtn.onclick = () => {
                    notesInput.value = item.original_notes;
                    document.getElementById('summaryOutput').innerHTML = `
                        <h3 class="font-semibold text-lg mb-2 text-green-700">Resumo Original Salvo:</h3>
                        <p class="text-sm font-semibold mb-2 text-gray-600">Tema Salvo: ${item.theme}</p>
                        <div class="prose max-w-none text-sm mt-2">${item.ai_summary.trim().replace(/\n/g, '<br>')}</div>
                    `;
                    document.getElementById('summaryOutput').classList.remove('hidden');
                    checkButtonsStatus();
                    notesInput.scrollIntoView({ behavior: 'smooth' });
                };

                itemDiv.appendChild(actionBtn);
                historyList.appendChild(itemDiv);
            });
        };

        window.onload = renderHistory;

        // === FUN√á√ïES DE API E PROMPT ===

        const BASE_SYSTEM_INSTRUCTION = `
            Voc√™ √© um Tutor Amig√°vel e Especialista em PLD/AML (Preven√ß√£o √† Lavagem de Dinheiro), focado no conte√∫do e terminologias do curso ACAMS.
            Seu objetivo √© ajudar um(a) estudante de n√≠vel Intermedi√°rio.
            TODAS as suas explica√ß√µes, defini√ß√µes e exemplos devem usar o vocabul√°rio e o contexto t√©cnico de PLD/AML (Ex: Due Diligence, PEP, STR, KYC).
            Mantenha um tom encorajador e profissional.
        `;

        /**
         * üö® CORRE√á√ÉO ESTRUTURAL FINAL: Usa o role 'system' dentro do array contents para passar a persona.
         */
        async function callGemini(systemInstruction, userPrompt, responseSchema = null) {
            if (API_KEY === 'SEU_GEMINI_API_KEY_AQUI' || !API_KEY) {
                alert("Erro: A API Key n√£o foi configurada. Por favor, insira sua chave no c√≥digo.");
                return null;
            }

            loadingIndicator.style.display = 'block';
            
            // CONTE√öDO: Primeiro a instru√ß√£o do sistema, depois a requisi√ß√£o do usu√°rio.
            const contentsArray = [
                {
                    role: "system",
                    parts: [{ text: systemInstruction }]
                },
                { 
                    role: "user", 
                    parts: [{ text: userPrompt }] 
                }
            ];

            const body = {
                contents: contentsArray
            };
            
            // Adiciona a configura√ß√£o de JSON para sa√≠da estruturada (generationConfig)
            if (responseSchema) {
                body.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: responseSchema
                };
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                
                const data = await response.json();
                
                if (response.ok && data.candidates && data.candidates.length > 0) {
                    let resultText = data.candidates[0].content.parts[0].text;
                    // Limpa wrappers de JSON se presentes
                    if (responseSchema) {
                        resultText = resultText.replace(/```json|```/g, '').trim();
                    }
                    return resultText;
                } else {
                    console.error("Erro da API:", data);
                    const errorMsg = data.error?.message || response.statusText || "Erro desconhecido.";
                    alert(`Erro ao processar a requisi√ß√£o. Status: ${response.status}. Mensagem: ${errorMsg}`);
                    return null;
                }

            } catch (error) {
                console.error("Erro de Rede:", error);
                alert("Erro ao processar a requisi√ß√£o. Verifique sua conex√£o e a Console para detalhes.");
                return null;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        // === M√ìDULO 1: RESUMO (E o restante dos m√≥dulos) ===
        // Os cliques dos bot√µes (summarizeBtn.onclick, translateBtn.onclick, quizBtn.onclick)
        // chamam a fun√ß√£o callGemini, que agora est√° com a estrutura correta.
        
        // (***O restante das fun√ß√µes de M√ìDULO 1, 2 e 3 deve ser mantido, pois est√£o corretas***)
        
        // Colocando a chamada dos bot√µes aqui para que o usu√°rio saiba que deve manter.
        summarizeBtn.onclick = async () => {
            const notes = notesInput.value.trim();
            if (!notes) return;

            const summarySchema = { /* ... (schema omitido por brevidade, mas deve estar no c√≥digo final) ... */ };
            const prompt = `
                Com base no texto de anota√ß√µes fornecido abaixo, fa√ßa o seguinte:
                1. Gere um TEMA CONCISO.
                2. Crie um T√çTULO ATRAENTE para o resumo.
                3. Crie um RESUMO de 3 a 5 par√°grafos (m√°x. 250 palavras) focado em PLD/AML e nos conceitos ACAMS.

                TEXTO DO ESTUDANTE:
                ---
                ${notes}
                ---
            `;
            
            const resultJsonText = await callGemini(BASE_SYSTEM_INSTRUCTION, prompt, summarySchema);
            
            if (resultJsonText) {
                try {
                    const data = JSON.parse(resultJsonText);
                    document.getElementById('outputSummaryTitle').textContent = data.summary_title;
                    const outputDiv = document.getElementById('summaryOutput');
                    
                    outputDiv.innerHTML = `
                        <h3 class="font-semibold text-lg mb-2 text-green-700">${data.summary_title}</h3>
                        <p class="text-sm font-semibold mb-2 text-gray-600">Tema Salvo: ${data.theme}</p>
                        <div class="prose max-w-none">${data.summary_body.trim().replace(/\n/g, '<br>')}</div>
                    `;
                    outputDiv.classList.remove('hidden');

                    saveNoteToHistory(data.theme, notes, data.summary_body);

                } catch (e) {
                    console.error("Erro ao fazer parse do JSON do Resumo:", e);
                    alert("A IA gerou um formato de resposta inv√°lido. Tente novamente.");
                }
            }
        };

        // ... (O restante dos bot√µes 'translateBtn.onclick' e 'quizBtn.onclick' devem ser mantidos)
        
    </script>
</body>
</html>
